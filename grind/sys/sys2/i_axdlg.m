function i_axdlg

global g_grind

varnames=i_statevars_names;
varnames=[ {''} varnames g_grind.pars];

hfig = figure('Units','characters',...
    'PaperUnits',get(0,'defaultfigurePaperUnits'),...
    'Color',[0.941176470588235 0.941176470588235 0.941176470588235],...
    'IntegerHandle','off',...
    'InvertHardcopy',get(0,'defaultfigureInvertHardcopy'),...
    'MenuBar','none',...
    'Name','AX - define axes for phase plane plots',...
    'NumberTitle','off',...
    'PaperPosition',get(0,'defaultfigurePaperPosition'),...
    'PaperSize',get(0,'defaultfigurePaperSize'),...
    'PaperType',get(0,'defaultfigurePaperType'),...
    'Position',[103.8 39.1538461538462 110.2 22.3076923076923],...
    'Resize','on',...
    'UserData',[],...
    'Tag','figure1',...
    'Visible','on',...
    'ResizeFcn',@resize_fun,...
    'CreateFcn',@(h,evnt)movegui(h, 'center'));


uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'HorizontalAlignment','left',...
    'Position',[9.8 12.7692307692308 13.8 1.76923076923077],...
    'String','X axis',...
    'Style','text',...
    'Tag','text2' );
uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'HorizontalAlignment','left',...
    'Position',[9.8 9 13.6 1.69230769230769],...
    'String','Y axis',...
    'Style','text',...
    'Tag','text3' );

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'HorizontalAlignment','left',...
    'Position',[9.8 5.30769230769231 15.6 1.53846153846154],...
    'String','Z axis',...
    'Style','text',...
    'Tag','text4');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'HorizontalAlignment','left',...
    'Position',[29.8 14.5384615384615 13.8 1.76923076923077],...
    'String','Variable',...
    'Style','text',...
    'Tag','text5');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'HorizontalAlignment','left',...
    'Position',[59.6 14.5384615384615 13.8 1.76923076923077],...
    'String','Minimum',...
    'Style','text',...
    'Tag','text6');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'HorizontalAlignment','left',...
    'Position',[79.6000000000001 14.5384615384615 13.8 1.76923076923077],...
    'String','Maximum',...
    'Style','text',...
    'Tag','text7');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'Callback',@okpressed,...
    'Position',[49.8 1.30769230769231 13.8 1.69230769230769],...
    'TooltipString','Close and save changes',...
    'String','OK',...
    'Tag','OKButton');

uicontrol(...
    'Parent',hfig,...
    'Callback',@cancelpressed,...
    'Units','characters',...
    'Position',[69.8 1.30769230769231 13.8 1.69230769230769],...
    'String','Cancel',...
    'TooltipString','Close without saving',...
    'Tag','CancelButton');

uicontrol(...
    'Parent',hfig,...
    'Callback','commands(''ax'')',...
    'Units','characters',...
    'Position',[89.8 1.30769230769231 13.8 1.69230769230769],...
    'TooltipString','Get help on the command ax',...
    'String','Help',...
    'Tag','HelpButton');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'Position',[29.8 13 19 1.53846153846154],...
    'String',varnames,...
    'TooltipString','Variable or equation of x-axis',...
    'Style','popupmenu',...
    'Value',1,...
    'Tag','x_popup');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'callback',@(h,ev)edit_function(h,ev,'x'),...
    'Position',[29.8+20 13 4 1.6],...
    'String','...',...
    'TooltipString','Enter any equation for the x axis',...
    'Tag','x_button');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'HorizontalAlignment','left',...
    'Position',[59.6 12.8461538461538 14.6 1.69230769230769],...
    'String','',...
    'TooltipString','Minimum value of x-axis',...
    'Style','edit',...
    'Tag','x_min_edit');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'HorizontalAlignment','left',...
    'Position',[79.8 12.8461538461538 14.6 1.69230769230769],...
    'String','',...
    'TooltipString','Maximum value of x-axis',...
    'Style','edit',...
    'Tag','x_max_edit');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'Position',[29.8 9.15 19 1.53846153846154],...
    'String',varnames,...
    'TooltipString','Variable or equation of y-axis',...
    'Style','popupmenu',...
    'Value',1,...
    'Tag','y_popup');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'callback',@(h,ev)edit_function(h,ev,'y'),...
    'Position',[29.8+20 9.15 4 1.6],...
    'String','...',...
    'TooltipString','Enter any equation for the y-axis',...
    'Tag','y_button');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'HorizontalAlignment','left',...
    'Position',[59.8 9 14.6 1.69230769230769],...
    'String','',...
    'TooltipString','Minimum value of y-axis',...
    'Style','edit',...
    'Tag','y_min_edit');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'HorizontalAlignment','left',...
    'Position',[79.8 9 14.6 1.69230769230769],...
    'String','',...
    'Style','edit',...
    'TooltipString','Maximum value of y-axis',...
    'Tag','y_max_edit');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'Position',[29.8 5.30 19 1.53846153846154],...
    'String',varnames,...
    'Style','popupmenu',...
    'TooltipString','Variable or equation of z-axis',...
    'Value',1,...
    'Tag','z_popup');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'callback',@(h,ev)edit_function(h,ev,'z'),...
    'Position',[29.8+20 5.30 4 1.8],...
    'String','...',...
    'TooltipString','Enter any equation for the z-axis',...
    'Tag','z_button');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'HorizontalAlignment','left',...
    'Position',[59.8 5.15384615384615 14.6 1.69230769230769],...
    'String','',...
    'TooltipString','Minimum value of z-axis',...
    'Style','edit',...
    'Tag','z_min_edit');

uicontrol(...
    'Parent',hfig,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'HorizontalAlignment','left',...
    'Position',[79.8 5.15384615384615 14.6 1.69230769230769],...
    'String','',...
    'TooltipString','Maximum value of z-axis',...
    'Style','edit',...
    'Tag','z_max_edit');



set_axis_data(hfig,g_grind.xaxis,'x');
set_axis_data(hfig,g_grind.yaxis,'y');
set_axis_data(hfig,g_grind.zaxis,'z');
uiwait(hfig)
if ishandle(hfig)
    delete(hfig)
end
function set_axis_data(hfig,axis,xyz)
h=findobj(hfig,'tag',[ xyz '_popup']);
data=get(h,'string');
f=find(strcmp(data,axis.var));
if isempty(f)
    f=length(data)+1;
    data{f}=axis.var ;
    set(h,'string',data);
end
set(h,'value',f);

h=findobj(hfig,'tag',[ xyz '_min_edit']);
set(h,'string',num2str(axis.lim(1)));
h=findobj(hfig,'tag',[ xyz '_max_edit']);
set(h,'string',num2str(axis.lim(2)));
function axis=get_axis_data(hfig,xyz)
h=findobj(hfig,'tag',[ xyz '_popup']);
data=get(h,'string');
f=get(h,'value');
axis.var=data{f};
h=findobj(hfig,'tag',[ xyz '_min_edit']);
axis.lim(1)=str2double(get(h,'string'));
h=findobj(hfig,'tag',[ xyz '_max_edit']);
axis.lim(2)=str2double(get(h,'string'));


function edit_function(hobject,~,xyz)
hfig=getparentfig(hobject);
h=findobj(hfig,'tag',[ xyz '_popup']);
data=get(h,'string');
f=get(h,'value');
fun=data{f};
prompt={sprintf('Enter any equation for the %s-axis:',xyz)};
answer=inputdlg(prompt,'Axis',1,{fun});
if ~isempty(answer)
    f=find(strcmp(data,answer{1}));
    if isempty(f)
        f=length(data)+1;
        data{f}=answer{1} ;
        set(h,'string',data);
    end
    set(h,'value',f);
end


function resize_fun(hobj,~)
hfig=getparentfig(hobj);

data={...
'text2',[1 0 1 0],[36.75 136.25 51.75 17.25];...
'text3',[1 0 1 0],[36.75 99.5 51 16.5];...
'text4',[1 0 1 0],[36.75 63.5 58.5 15];...
'text5',[1 0 1 0],[111.75 161.5 51.75 17.25];...
'text6',[1 0 1 0],[223.5 161.5 51.75 17.25];...
'text7',[1 0 1 0],[298.5 161.5 51.75 17.25];...
'OKButton',[1 0 0 1],[116+46 12.75 51.75 16.5];...
'CancelButton',[1 0 0 1],[186+46 12.75 51.75 16.5];...
'HelpButton',[1 0 0 1],[256+46 12.75 51.75 16.5];...
'x_popup',[1 0 1 0],[111.75 138.5 71.25 15];...
'x_button',[1 0 1 0],[186.75 138.5 15 15.6];...
'x_min_edit',[1 0 1 0],[224.25 137 54.75 16.5];...
'x_max_edit',[1 0 1 0],[299.25 137 54.75 16.5];...
'y_popup',[1 0 1 0],[111.75 100.9625 71.25 15];...
'y_button',[1 0 1 0],[186.75 100.9625 15 15.6];...
'y_min_edit',[1 0 1 0],[224.25 99.5 54.75 16.5];...
'y_max_edit',[1 0 1 0],[299.25 99.5 54.75 16.5];...
'z_popup',[1 0 1 0],[111.75 63.425 71.25 15];...
'z_button',[1 0 1 0],[186.75 63.425 15 15.6];...
'z_min_edit',[1 0 1 0],[224.25 62 54.75 16.5];...
'z_max_edit',[1 0 1 0],[299.25 62 54.75 16.5];...
};
i_resizedlg(hfig,data(:,1),data(:,2),data(:,3),[305.25 170.25 413.25 216.75]);



function okpressed(hobject,~)
global g_grind;
hfig=getparentfig(hobject);
g_grind.xaxis=get_axis_data(hfig,'x');
g_grind.yaxis=get_axis_data(hfig,'y');
g_grind.zaxis=get_axis_data(hfig,'z');
uiresume()
function cancelpressed(~,~)
uiresume()