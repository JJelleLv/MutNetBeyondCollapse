function answers=i_funplotdlg(defanswers)
if nargin==0
    defanswers={'', ... %1 function
        'x', ... %2 variable
        'N', ... %3 exchange
        '[0.01 100]', ... %4 xrange
        '[]', ... %5 yrange
        '',... %6 logx,logy,logxy
        '100'}; %7 number of points
end


exchange= strcmpi(defanswers{3},'Y');
rangex=regexp(defanswers{4},'[\[\] ]','split');
ndx=cellfun('isempty',rangex);
rangex=rangex(~ndx);
if numel(rangex)~=2
    rangex={'',''};
end


logxy=defanswers{6};
logx=1;
logy=1;
switch logxy
    case 'logx'
        logx=2;
    case 'logy'
        logy=2;
    case 'logxy'
        logx=2;
        logy=2;
end


rangey=regexp(defanswers{5},'[\[\] ]','split');
ndx=cellfun('isempty',rangey);
rangey=rangey(~ndx);
if numel(rangey)~=2
    rangey={'',''};
end


hfig = figure(...
'Units','characters',...
'PaperUnits',get(0,'defaultfigurePaperUnits'),...
'Color',[0.941176470588235 0.941176470588235 0.941176470588235],...
'IntegerHandle','off',...
'InvertHardcopy',get(0,'defaultfigureInvertHardcopy'),...
'MenuBar','none',...
'Name','funplot',...
'NumberTitle','off',...
'PaperPosition',get(0,'defaultfigurePaperPosition'),...
'PaperSize',get(0,'defaultfigurePaperSize'),...
'PaperType',get(0,'defaultfigurePaperType'),...
'Position',[86.6 12.6153846153846 82.6 32],...
'Resize','on',...
'ResizeFcn',@resize,...
'CreateFcn', @(h,evnt)movegui(h,'center') ,...
'HandleVisibility','on',...
'Tag','figure1');

 uipanel(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'Title','X-axis',...
'Tag','XaxisPanel',...
'Clipping','on',...
'Position',[3 13.4615384615385 72.4 7.53846153846154] );

uipanel(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'Title','Y-axis',...
'Tag','YaxisPanel',...
'Clipping','on',...
'Position',[2.8 4.84615384615386 72.4 7.53846153846154] );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 30.3076923076923 33.2 1.07692307692308],...
'String','Equation:',...
'Style','text',...
'Tag','Functext1');

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'String',defanswers{1},...
'Position',[5.6 28.6153846153847 69.2 1.69230769230769],...
'Tooltipstring',sprintf('Edit the equation to plot \n(you can use parameters, state and auxiliary variables from the current model)'),...
'Style','edit',...
'Tag','edit_fun' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 26.3846153846154 24.4 1.07692307692308],...
'String','Independent variable:',...
'Style','text',...
'Tag','IndepVartext' );

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 24.4615384615385 20.2 1.69230769230769],...
'String',defanswers{2},...
'Style','edit',...
'Tooltipstring','Type the symbol of the independent variable (=for the x-axis)',...
'Tag','edit_var');

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[35.6 24.4615384615385 20.2 1.69230769230769],...
'String',defanswers{7},...
'Tooltipstring','How many points are needed for plotting',...
'Style','edit',...
'Tag','editpoints' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'Position',[5.6 22.2 40 1.53846153846154],...
'String','Exchange x and y axis',...
'Tooltipstring','Check this to plot the independent variable on the y-axis',...
'Value',exchange,...
'Style','checkbox',...
'Tag','exchange_check' );

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[15.8 17.3846153846154 15.2 1.69230769230769],...
'String',rangex{1},...
'Tooltipstring','Range of x axis: minimum',...
'Style','edit',...
'Tag','edit_fromx' );

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[38.6000000000002 17.4615384615385 15.2 1.69230769230769],...
'String',rangex{2},...
'Tooltipstring','Range of the x axis: maximum',...
'Style','edit',...
'Tag','edit_tox' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 17.6153846153846 10 1.15384615384615],...
'String','X-Limits',...
'Style','text',...
'Tag','XlimText' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[32.8000000000001 17.8461538461539 4.6 1.15384615384615],...
'String','to',...
'Style','text',...
'Tag','ToText');

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 15.1538461538462 10.2 1.15384615384615],...
'String','X-Scale',...
'Style','text',...
'Tag','XscaleText');

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'Position',[16.2 14.6153846153846 37.2 1.76923076923077],...
'String',{  'Linear'; 'Logarithmic' },...
'Style','popupmenu',...
'Tooltipstring','Kind of scale of x axis (linear or log)',...
'Value',logx,...
'Tag','popup_logx' );


 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[15.6 8.7692307692308 15.2 1.69230769230769],...
'Style','edit',...
    'Tooltipstring','Range of y-axis: minimum',...
'String',rangey{1},...
'Tag','edit_fromy');

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'Callback',@checkauto ,...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[38.4000000000001 8.84615384615386 15.2 1.69230769230769],...
'Style','edit',...
    'Tooltipstring','Range of y-axis: maximum',...
'String',rangey{2},...
'Tag','edit_toy' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 9.00000000000002 10 1.15384615384615],...
'String','Y-Limits',...
'Style','text',...
'Tag','YlimitsText' );
uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'Position',[54.6 8.77692307692309 15 1.76923076923077],...
'String','Automatic',...
'Tooltipstring','Automatic scaling of y-axis',...
'Style','checkbox',...
'Value',isempty(rangey{1})||isempty(rangey{2}),...
'Tag','check_auto');

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[32.6000000000001 9.23076923076929 4.6 1.15384615384615],...
'String','to',...
'Style','text',...
'Tag','To2Text' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[5.6 6.53846153846156 10.2 1.15384615384615],...
'String','Y-Scale',...
'Style','text',...
'Tag','YScaleText' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'BackgroundColor',[1 1 1],...
'FontSize',10.6666666666667,...
'Position',[16 6.00000000000002 37.2 1.76923076923077],...
'String',{  'Linear'; 'Logarithmic' },...
    'Tooltipstring','Kind of scale of y-axis (linear or log)',...
'Style','popupmenu',...
'Value',logy,...
'Tag','popup_logy');

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'Callback',@(h,events)uiresume(get(h,'parent')),...
'FontSize',10.6666666666667,...
'Position',[23 1 16.6 2.38461538461538],...
    'Tooltipstring','Create figure of the function',...
'String','OK',...
'Tag','OKbutton' );

 uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'Callback',@(h,events)delete(get(h,'parent')),...
'FontSize',10.6666666666667,...
'Position',[47 1 16.6 2.38461538461538],...
    'Tooltipstring','Cancel no figure is made',...
'String','Cancel',...
'Tag','Cancelbutton' );

uicontrol(...
'Parent',hfig,...
'Units','characters',...
'FontUnits','pixels',...
'FontSize',10.6666666666667,...
'HorizontalAlignment','left',...
'Position',[35.4 26.3076923076923 24.4 1.07692307692308],...
'String','Number of points',...
'Style','text',...
'Tag','NumPointstext');

uiwait(hfig);
if ishandle(hfig)
    
    h=findobj(hfig,'Tag','edit_fun');
    answers{1}=get(h,'string');
    h=findobj(hfig,'Tag','edit_var');
    answers{2}=get(h,'string');
    h=findobj(hfig,'Tag','exchange_check');
    if get(h,'Value')==1
        answers{3}='Y';
    else
        answers{3}='N';
    end
    h=findobj(hfig,'Tag','edit_fromx');
    s1=get(h,'string');
    h=findobj(hfig,'Tag','edit_tox');
    s2=get(h,'string');
    if isempty(s1)||isempty(s2)
        answers{4}='[]';
    else
        answers{4}=sprintf('[%s %s]',s1,s2);
    end

    h=findobj(hfig, 'Tag','check_auto' );
    if get(h,'value')==1
        answers{5}='[]';
    else
        h=findobj(hfig,'Tag','edit_fromy');
        s1=get(h,'string');
        h=findobj(hfig,'Tag','edit_toy');
        s2=get(h,'string');
        if isempty(s1)||isempty(s2)
            answers{5}='[]';
        else
            answers{5}=sprintf('[%s %s]',s1,s2);
        end

    end

    h=findobj(hfig,'Tag','popup_logx');
    logx=get(h,'Value');
    h=findobj(hfig,'Tag','popup_logy');
    logy=get(h,'Value');
    if logx==2&&logy==2
        answers{6}='logxy';
    elseif logx==2
        answers{6}='logx';
    elseif logy==2
        answers{6}='logy';
    else
        answers{6}='';
    end

    h=findobj(hfig,'Tag','editpoints' );
    answers{7}=get(h,'string');
    delete(hfig);
else
    answers={};
end

function resize(hobj,~)
hfig=getparentfig(hobj);
data={'XaxisPanel',[1 1 1 0],[11.25 131.25 271.5 73.5];...
'YaxisPanel',[1 1 1 0],[10.5 47.25 271.5 73.5];...
'Functext1',[1 0 1 0],[21 295.5 124.5 10.5];...
'edit_fun',[1 1 1 0],[21 279 259.5 16.5];...
'IndepVartext',[1 1 1 0],[21 257.25 91.5 10.5];...
'edit_var',[1 1 1 0],[21 238.5 75.75 16.5];...
'editpoints',[0 1 1 0],[133.5 238.5 75.75 16.5];...
'exchange_check',[1 0 1 0],[21 216.45 150 15];...
'edit_fromx',[1 1 1 0],[60 169.5 57 16.5];...
'edit_tox',[0 1 1 0],[144.75 170.25 57 16.5];...
'XlimText',[1 0 1 0],[21 171.75 37.5 11.25];...
'ToText',[0 1 1 0],[123 174 17.25 11.25];...
'XscaleText',[1 0 1 0],[21 147.75 38.25 11.25];...
'popup_logx',[1 1 1 0],[60 142.5 141 17.25];...
'edit_fromy',[1 1 1 0],[60 85.5 57 16.5];...
'edit_toy',[0 1 1 0],[144 86.25 57 16.5];...
'YlimitsText',[1 0 1 0],[21 87.75 37.5 11.25];...
'check_auto',[0 1 1 0],[204.75 85.575 56.25 17.25];...
'To2Text',[0 1 1 0],[122.25 90 17.25 11.25];...
'YScaleText',[1 0 1 0],[21 63.75 38.25 11.25];...
'popup_logy',[1 1 1 0],[60 58.5 141 17.25];...
'OKbutton',[1 0 1 0],[86.25 9.75 62.25 23.25];...
'Cancelbutton',[1 0 1 0],[176.25 9.75 62.25 23.25];...
'NumPointstext',[0 1 1 0],[132.75 256.5 91.5 10.5]};
i_resizedlg(hfig,data(:,1),data(:,2),data(:,3),[324.75 123 309.75 312]);
res=i_resizedlg(hfig,'horizdistrib',{'edit_fromy','edit_toy'});
if ~isempty(res)
    h=findobj(hfig,'tag','To2Text');
    pos=get(h,'position');
    pos(1)=pos(1)+res(1);
    set(h,'position',pos);
    res=i_resizedlg(hfig,'horizdistrib',{'edit_fromx','edit_tox'});
    h=findobj(hfig,'tag','ToText');
    pos=get(h,'position');
    pos(1)=pos(1)+res(1);
    set(h,'position',pos);
    res=i_resizedlg(hfig,'horizdistrib',{'edit_var','editpoints'});
    h=findobj(hfig,'tag','NumPointstext');
    pos=get(h,'position');
    pos(1)=pos(1)+res(1);
    set(h,'position',pos);
end

function checkauto(hobject,~)
hfig=getparentfig(hobject);
h=findobj(hfig,'tag','edit_fromy');
s1=get(h,'string');
h=findobj(hfig,'tag','edit_toy');
s2=get(h,'string');
h=findobj(hfig, 'Tag','check_auto' );
if ~isempty(s1)&&~isempty(s2)
    set(h,'value',0);
elseif isempty(s1)&&isempty(s2)
    set(h,'value',1);
end

